"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[93],{1470:(e,n,t)=>{t.d(n,{A:()=>v});var o=t(6540),i=t(4164),r=t(3104),a=t(6347),s=t(205),l=t(7485),d=t(1682),c=t(679);function u(e){return o.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,o.useMemo)((()=>{const e=n??function(e){return u(e).map((({props:{value:e,label:n,attributes:t,default:o}})=>({value:e,label:n,attributes:t,default:o})))}(t);return function(e){const n=(0,d.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p({value:e,tabValues:n}){return n.some((n=>n.value===e))}function m({queryString:e=!1,groupId:n}){const t=(0,a.W6)(),i=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(i),(0,o.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(t.location.search);n.set(i,e),t.replace({...t.location,search:n.toString()})}),[i,t])]}function g(e){const{defaultValue:n,queryString:t=!1,groupId:i}=e,r=h(e),[a,l]=(0,o.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find((e=>e.default))??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:r}))),[d,u]=m({queryString:t,groupId:i}),[g,y]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,i]=(0,c.Dv)(n);return[t,(0,o.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:i}),f=(()=>{const e=d??g;return p({value:e,tabValues:r})?e:null})();(0,s.A)((()=>{f&&l(f)}),[f]);return{selectedValue:a,selectValue:(0,o.useCallback)((e=>{if(!p({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),y(e)}),[u,y,r]),tabValues:r}}var y=t(2303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var _=t(4848);function w({className:e,block:n,selectedValue:t,selectValue:o,tabValues:a}){const s=[],{blockElementScrollPositionUntilNextRender:l}=(0,r.a_)(),d=e=>{const n=e.currentTarget,i=s.indexOf(n),r=a[i].value;r!==t&&(l(n),o(r))},c=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=s.indexOf(e.currentTarget)+1;n=s[t]??s[0];break}case"ArrowLeft":{const t=s.indexOf(e.currentTarget)-1;n=s[t]??s[s.length-1];break}}n?.focus()};return(0,_.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},e),children:a.map((({value:e,label:n,attributes:o})=>(0,_.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{s.push(e)},onKeyDown:c,onClick:d,...o,className:(0,i.A)("tabs__item",f.tabItem,o?.className,{"tabs__item--active":t===e}),children:n??e},e)))})}function b({lazy:e,children:n,selectedValue:t}){const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=r.find((e=>e.props.value===t));return e?(0,o.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,_.jsx)("div",{className:"margin-top--md",children:r.map(((e,n)=>(0,o.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function x(e){const n=g(e);return(0,_.jsxs)("div",{className:(0,i.A)("tabs-container",f.tabList),children:[(0,_.jsx)(w,{...n,...e}),(0,_.jsx)(b,{...n,...e})]})}function v(e){const n=(0,y.A)();return(0,_.jsx)(x,{...e,children:u(e.children)},String(n))}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>s});var o=t(6540);const i={},r=o.createContext(i);function a(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),o.createElement(r.Provider,{value:n},e.children)}},9230:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>a,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"developer/environment","title":"Running scripts","description":"The previous section explained how to run a script from within Tangerine by using the Command Line window, but in general we run Tangerine scripts through a pipeline by calling the software in a system terminal or in a shell script:","source":"@site/docs/developer/environment.md","sourceDirName":"developer","slug":"/developer/environment","permalink":"/tangerine-docs/developer/environment","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Hello Tangerine","permalink":"/tangerine-docs/developer/hello_tangerine"},"next":{"title":"API Structure","permalink":"/tangerine-docs/developer/general_concepts/api_structure"}}');var i=t(4848),r=t(8453);t(1470),t(9365);const a={sidebar_position:2},s="Running scripts",l={},d=[{value:"Production Environment",id:"production-environment",level:2},{value:"Custom menu and GUI",id:"custom-menu-and-gui",level:2},{value:"Editing and Debugging your scripts with VS Code",id:"editing-and-debugging-your-scripts-with-vs-code",level:2},{value:"Hot reload of scripts",id:"hot-reload-of-scripts",level:2}];function c(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"running-scripts",children:"Running scripts"})}),"\n",(0,i.jsx)(n.p,{children:"The previous section explained how to run a script from within Tangerine by using the Command Line window, but in general we run Tangerine scripts through a pipeline by calling the software in a system terminal or in a shell script:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Script to launch Tangerine and directly run your script:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:".\\Tangerine.exe path_to/your_script.shot\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Script to launch Tangerine, open a shot file and call your script:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:".\\Tangerine.exe path_to/your_show.shot other_path_to/your_batch_script.py\n"})}),"\n",(0,i.jsx)(n.p,{children:"Note you may add multiple scripts in the command."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Batch processes that don't need any GUI can be called with the ",(0,i.jsx)(n.code,{children:"--no-gui"})," argument:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:".\\Tangerine.exe --no-gui path_to/your_show.shot other_path_to/your_batch_script.py\n"})}),"\n",(0,i.jsx)(n.p,{children:"In this case, Tangerine is launched but does not pop any window, it exits once the script is over."}),"\n",(0,i.jsx)(n.admonition,{type:"important",children:(0,i.jsx)(n.p,{children:"The working directory (cwd) should always be set to the installation directory where Tangerine.exe is located before launching Tangerine.exe."})}),"\n",(0,i.jsx)(n.p,{children:"See the Command Line Arguments page to list all the possible argument you can pass to Tangerine."}),"\n",(0,i.jsx)(n.h2,{id:"production-environment",children:"Production Environment"}),"\n",(0,i.jsx)(n.p,{children:"You will possibly need an environment for your studio, a given production or a group of users. In this case, you may want to ensure a given script is actually executed first every time Tangerine is launched. In this script you would setup some paths (for libraries, and pickers) and initialize your own tools to customize the Tangerine GUI."}),"\n",(0,i.jsxs)(n.p,{children:["To do so, use the ",(0,i.jsx)(n.code,{children:"TANG_ENV_PATH"})," environment variable on your system to define the path of a ",(0,i.jsx)(n.code,{children:"user_setup.py"})," file.\nThis file will be executing at every launch of Tangerine, before executing another command."]}),"\n",(0,i.jsx)(n.h2,{id:"custom-menu-and-gui",children:"Custom menu and GUI"}),"\n",(0,i.jsx)(n.p,{children:"Tangerine as been developped to be the closest possible of animators needs. Everything you will find native in the software has been optimized in UX and performances way.\nPlease contact us if you think any of your tools should be part of Tangerine.\nThat said, you may need to develop some workaround tools to integrate Tangerine in the best way possible for your teams."}),"\n",(0,i.jsx)(n.p,{children:"You can customize menus, add buttons with preconfigured actions, or even add tools for your teams.\nHere is a very simple startup script to add your own menu in Tangerine, with a command to show a custom Qt Window:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from tang_gui.get_tang_window import get_tang_window\nfrom PySide2.QtCore import Qt\nfrom PySide2.QtWidgets import QWidget\n\nmain_window = get_tang_window()\n\ndef show_my_tool_window():\n    my_tool_widget = QWidget(main_window)\n    my_tool_widget.setWindowTitle('My Tool')\n    my_tool_widget.setFixedHeight(100)  # replace this with your layout of widgets\n    main_window.add_dock_for_view(my_tool_widget, Qt.RightDockWidgetArea)\n\nif main_window:  # safety in case Tangerine is called in --no-gui mode\n    from tang_gui.tang_action import add_action\n    menu_bar = main_window.menuBar()\n    my_menu = menu_bar.addMenu('My Studio')\n    my_menu.addAction(add_action(main_window, \"My Tool\", show_my_tool_window))\n"})}),"\n",(0,i.jsx)(n.p,{children:"Save this file in my_tool.py and call:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:".\\Tangerine.exe path_to/my_tool.py\n"})}),"\n",(0,i.jsx)(n.p,{children:'Now, you have the "My Studio" menu with the "My Tool" menu item and if you select it the "My Tool" window appears docked at the bottom left of the Tangerine GUI!'}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"You may call .\\TangerineConsole.exe instead of .\\Tangerine.exe to see your script output (and errors) in the Console. Otherwise you should look at the log file in %TEMP%/Tangerine/logs"})}),"\n",(0,i.jsx)(n.p,{children:"Tangerine doesn't have a full blown script editor and debugger, that's because today most TDs prefer to use standard Python editors for that purpose. The main Python IDEs today are VS Code from Microsoft (free) and PyCharm from Jetbrains (a free community edition is available)."}),"\n",(0,i.jsx)(n.h2,{id:"editing-and-debugging-your-scripts-with-vs-code",children:"Editing and Debugging your scripts with VS Code"}),"\n",(0,i.jsx)(n.p,{children:"You first need to have the Python langage extension from Microsoft added to VS Code."}),"\n",(0,i.jsxs)(n.p,{children:["Then, set this configuration in your ",(0,i.jsx)(n.code,{children:"launch.json"})," file:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "version": "0.2.0",\n    "configurations": [\n        {\n            "type": "debugpy",\n            "name": "Attach Tangerine App",\n            "request": "attach",\n            "processId": "${command:pickProcess}",\n            "connect": { "host": "127.0.0.1", "port": 5678 }\n        }\n    ]\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["As we don't provide the ",(0,i.jsx)(n.code,{children:"debugpy"})," module in the Tangerine interpreter, you need to create a compatible venv (ie ",(0,i.jsx)(n.strong,{children:"Python 3.9"}),") and pip install this module in it:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"MyScripts\n   |\n   +-- my_tool.py <= use the script above\n   |\n   +-- wait_debug.py <= see below\n   |\n   +-- .venv <= Python 3.9 virtual environment where you added the debugpy module\n   |\n   +-- .vscode\n         |\t\n         +-- launch.json\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Here is the ",(0,i.jsx)(n.code,{children:"wait_debug.py"})," code:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from pathlib import Path\nimport os\nimport site\n\n# we activate the site-packages of a compatible venv:\nhere = Path(__file__).resolve().parent\nvenv = here / ".venv"\nif os.name == "nt":\n    sp = venv / "Lib" / "site-packages"  # Windows: <venv>\\Lib\\site-packages\nelse:\n    pyver = f"python{sys.version_info.major}.{sys.version_info.minor}"\n    sp = venv / "lib" / pyver / "site-packages"  # Linux: <venv>/lib/pythonX.Y/site-packages\nif sp.exists():\n    site.addsitedir(str(sp))\nelse:\n\traise RuntimeError("Cannot find site-packages in the venv")\n\t\n# we import debugpy from the venv above and wait for the connection\ntry:\n    import debugpy\nexcept ImportError:\n    raise RuntimeError("debugpy is not installed in the venv")\ndebugpy.listen(("127.0.0.1", "5678"))\ndebugpy.wait_for_client()\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Then, launch Tangerine with this new script ",(0,i.jsx)(n.strong,{children:"first"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:".\\TangerineConsole.exe C:\\MyScripts\\wait_debug.py C:\\MyScripts\\my_tool.py\n"})}),"\n",(0,i.jsxs)(n.p,{children:["In VS Code, set a breakpoint anywhere in ",(0,i.jsx)(n.code,{children:"my_tool.py"}),', launch "Attach Tangerine App" and select the Tangerine process in the dropdown menu. You should break on the breakpoint!']}),"\n",(0,i.jsxs)(n.admonition,{type:"tip",children:[(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Aucompletion in VS Code!"})}),(0,i.jsxs)(n.p,{children:["In your ",(0,i.jsx)(n.code,{children:"settings.json"})," add the following lines to get autocompletion with the Tangerine API (you may have to replace the path with your custom Tangerine installation directory):"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'    "python.analysis.extraPaths": [\n        "C:/Program Files/Tangerine/stubs",\n    ],    \n    "python.autoComplete.extraPaths": [\n        "C:/Program Files/Tangerine/stubs",\n    ],\n'})})]}),"\n",(0,i.jsx)(n.h2,{id:"hot-reload-of-scripts",children:"Hot reload of scripts"}),"\n",(0,i.jsxs)(n.p,{children:["Sometimes you make changes to your script and you want Tangerine to take the changes into account without relaunching it.\nYou can do that with hot reload of modules. Indeed, Tangerine uses ",(0,i.jsx)(n.code,{children:"importlib.import_module(your_script_name)"})," where your_script_name is the filename of your script without the py extension. So, hot reloading a script is equivalent to reloading a python module with the same name. Enter the following in the Command Line window of Tangerine when your script has changed:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import sys\nsys.modules.pop(script_name, None)\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["You cannot hot reload scripts where a reference to your script objects/functions has been given to the Tangerine interpreter.\nFor example, in the above script my_tool.py we give a reference to the function ",(0,i.jsx)(n.code,{children:"show_my_tool_window()"})," to Tangerine so this script cannot be hot reloaded. In practice, add your updatable code in another module loaded via import_module, and hot reload only this module where no reference has been given in Tangerine or if you can delete them before the reload (see example below)."]})}),"\n",(0,i.jsx)(n.p,{children:"In the following example, the second script (my_edit.py) can be hot reloaded:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Modify my_tool.py:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from tang_gui.get_tang_window import get_tang_window\nfrom PySide2.QtCore import Qt\nfrom PySide2.QtWidgets import QWidget, QPushButton\nimport importlib\n\nmain_window = get_tang_window()\n\ndef on_clicked():\n    my_edit = importlib.import_module(\"my_edit\")\n    my_edit.do_it()\n\t\ndef show_my_tool_window():\n    my_tool_widget = QWidget(main_window)\n    my_tool_widget.setWindowTitle('My Tool')\n    btn = QPushButton('Do it!', my_tool_widget)\n    btn.clicked.connect(on_clicked)\n    main_window.add_dock_for_view(my_tool_widget, Qt.RightDockWidgetArea)\n\nif main_window:  # safety in case Tangerine is called in --no-gui mode\n    from tang_gui.tang_action import add_action\n    menu_bar = main_window.menuBar()\n    my_menu = menu_bar.addMenu('My Studio')\n    my_menu.addAction(add_action(main_window, \"My Tool\", show_my_tool_window))\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Add my_edit.py:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from tang_core.document.get_document import get_document\nfrom tang_core.callbacks import Callbacks\n\ndoc = get_document()\n\nasset_node = doc.root().find("character1:capy_jb")\n\nwith doc.modify("animate the capy") as modifier:\n    controller = Callbacks().find_controller_in_asset(asset_node, "c_face_up")\n    set_animated_plug_value(controller.el_blink_L, 0.0, modifier, frame=1, force_key=True)\n    set_animated_plug_value(controller.el_blink_L, 1.0, modifier, frame=7)\n    set_animated_plug_value(controller.el_blink_L, 0.0, modifier, frame=14)\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Launch Tangerine with my_tool.py as the argument."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Import JB the Capy asset via the File menu, or by using this script in the Command Line window:"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import os\ncapy_path = os.getcwd() + "/demo/assets/capy_jb/capy_jb.tang"\ndocument.import_nodes("character1:capy_jb", capy_path) \n'})}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:'Click on "Do it!", the Capy now blinks just like in Hello Tangerine'}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Undo (Ctrl+Z) and select ",(0,i.jsx)(n.strong,{children:"Clear History"})," in the Edit menu to ",(0,i.jsx)(n.strong,{children:"remove the Tangerine reference to the modifier"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Modify my_edit.py, put 0.5 instead of 1.0 in the second call of set_animated_plug_value (frame 7) so that the Capy will half blink."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"    # ...\n    set_animated_plug_value(controller.el_blink_L, 0.5, modifier, frame=7)\n    # ...                                          ^^^\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"7",children:["\n",(0,i.jsx)(n.li,{children:"Call this in the Command Line window:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import sys\nsys.modules.pop("my_edit", None)\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"8",children:["\n",(0,i.jsx)(n.li,{children:'Click on "Do it!" again and see the Capy half blinks!'}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{type:"tip",children:[(0,i.jsx)(n.p,{children:"The following works too, it may be more convenient because sys.modules.pop is not required then:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def on_clicked():\n    import importlib, my_edit\n    importlib.reload(my_edit)  # force the reload of the module (even if it has not changed)\n"})})]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},9365:(e,n,t)=>{t.d(n,{A:()=>a});t(6540);var o=t(4164);const i={tabItem:"tabItem_Ymn6"};var r=t(4848);function a({children:e,hidden:n,className:t}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,o.A)(i.tabItem,t),hidden:n,children:e})}}}]);